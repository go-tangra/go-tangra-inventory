<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">
  <Package Name="Tangra Inventory Collector"
           Manufacturer="Go-Tangra"
           Version="$(ProductVersion)"
           UpgradeCode="f2c4d6e8-3a5b-7c9d-1e0f-4b6d8a0c2e3f">

    <MajorUpgrade DowngradeErrorMessage="A newer version of Tangra Inventory Collector is already installed." />
    <MediaTemplate EmbedCab="yes" />

    <!-- Public properties configurable via msiexec -->
    <Property Id="CLIENT_SECRET" Secure="yes" />
    <Property Id="API_SECRET" Secure="yes" />

    <StandardDirectory Id="ProgramFiles6432Folder">
      <Directory Id="INSTALLFOLDER" Name="TangraCollector">
        <Component Id="MainExecutable" Guid="c4e6f8a2-5b7d-9c1e-3f0a-6d8b0c2e4f5a">
          <File Id="CollectorExe" Source="$(ExePath)" KeyPath="yes" />
          <ServiceInstall Id="InstallCollectorService"
                          Name="TangraInventoryCollector"
                          DisplayName="Tangra Inventory Collector"
                          Description="Receives inventory reports from agents and provides a REST API"
                          Type="ownProcess"
                          Start="auto"
                          ErrorControl="normal"
                          Arguments="serve --database=[DATAFOLDER]inventory.db --client-secret=[CLIENT_SECRET] --api-secret=[API_SECRET]" />
          <ServiceControl Id="ControlCollectorService"
                          Name="TangraInventoryCollector"
                          Start="install"
                          Stop="both"
                          Remove="uninstall"
                          Wait="yes" />
        </Component>
      </Directory>
    </StandardDirectory>

    <!-- Data directory for SQLite database -->
    <StandardDirectory Id="CommonAppDataFolder">
      <Directory Id="DATAFOLDER" Name="TangraCollector">
        <Component Id="DataDirectory" Guid="d5f7a9b3-6c8e-0d2f-4a1b-7e9c1d3f5a6b">
          <CreateFolder />
        </Component>
      </Directory>
    </StandardDirectory>

    <Feature Id="Complete" Title="Tangra Inventory Collector" Level="1">
      <ComponentRef Id="MainExecutable" />
      <ComponentRef Id="DataDirectory" />
    </Feature>
  </Package>
</Wix>
